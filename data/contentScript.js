var top1000 = ['google.com', 'facebook.com', 'youtube.com', 'yahoo.com',
'baidu.com', 'wikipedia.org', 'live.com', 'twitter.com', 'qq.com',
'amazon.com', 'linkedin.com', 'blogspot.com', 'taobao.com', 'google.co.in',
'yahoo.co.jp', 'sina.com.cn', 'msn.com', 'google.de', 'google.com.hk',
'yandex.ru', 'wordpress.com', 'bing.com', 'ebay.com', 'google.co.jp',
'babylon.com', 'google.co.uk', 'google.fr', 'vk.com', 'soso.com',
'googleusercontent.com', '163.com', 'microsoft.com', 'weibo.com',
'mail.ru', 'tumblr.com', 'google.com.br', 'apple.com', 'pinterest.com',
'google.es', 'paypal.com', 'craigslist.org', 'google.it', 'google.ru',
'xhamster.com', 'ask.com', 'blogger.com', 'go.com', 'sohu.com',
'bbc.co.uk', 'fc2.com', 'xvideos.com', 'imdb.com', 'youku.com',
'google.com.mx', 'avg.com', 'google.ca', 'flickr.com', 'tudou.com',
'hao123.com', 'tmall.com', 'ifeng.com', 'conduit.com', 't.co',
'odnoklassniki.ru', 'aol.com', 'pornhub.com', 'ebay.de', 'espn.go.com',
'livejasmin.com', 'adobe.com', 'cnn.com', 'amazon.de', 'google.co.id',
'rakuten.co.jp', 'thepiratebay.se', 'blogspot.in', 'amazon.co.jp',
'zedo.com', 'redtube.com', 'google.com.tr', 'mywebsearch.com', 'adf.ly',
'stackoverflow.com', 'ebay.co.uk', 'huffingtonpost.com', 'google.com.au',
'about.com', 'alibaba.com', 'sogou.com', 'amazon.co.uk', 'google.pl',
'uol.com.br', 'godaddy.com', 'wordpress.org', 'dailymotion.com',
'netflix.com', 'imgur.com', 'livedoor.com', 'instagram.com', '360buy.com',
'mediafire.com', 'youporn.com', 'globo.com', 'cnet.com', 'alipay.com',
'ameblo.jp', 'bp.blogspot.com', '360.cn', 'nytimes.com', 'adcash.com',
'chinaz.com', 'incredibar.com', 'xnxx.com', '4shared.com', 'google.nl',
'ehow.com', 'doubleclick.com', 'neobux.com', 'searchnu.com',
'google.com.sa', 'livejournal.com', 'vimeo.com', 'dropbox.com',
'google.com.ar', 'bankofamerica.com', 'douban.com', 'dailymail.co.uk',
'weather.com', 'reddit.com', 'torrentz.eu', 'search-results.com',
'renren.com', 'wigetmedia.com', 'tube8.com', 'indiatimes.com', 'kat.ph',
'warriorforum.com', 'pconline.com.cn', 'badoo.com', 'chase.com',
'deviantart.com', 'tianya.cn', 'secureserver.net', 'google.com.pk',
'mozilla.org', 'google.com.eg', 'aweber.com', 'blogspot.com.br',
'stumbleupon.com', 'blogfa.com', 'google.cn', 'amazonaws.com', 'cnzz.com',
'56.com', 'google.co.th', 'goo.ne.jp', 'google.co.za', 'spiegel.de',
'etsy.com', 'foxnews.com', 'sourceforge.net', 'slideshare.net', 'letv.com',
'walmart.com', 'squidoo.com', 'softonic.com', 'clicksor.com',
'comcast.net', 'wikimedia.org', 'addthis.com', 'espncricinfo.com',
'nicovideo.jp', 'answers.com', 'wellsfargo.com', 'liveinternet.ru',
'reference.com', 'google.co.ve', 'fiverr.com', 'allegro.pl', 'wikia.com',
'depositfiles.com', 'photobucket.com', 'themeforest.net', 'zol.com.cn',
'statcounter.com', 'onet.pl', 'booking.com', 'google.com.my',
'hootsuite.com', 'xinhuanet.com', 'myspace.com', 'salesforce.com',
'guardian.co.uk', 'bild.de', 'outbrain.com', 'fbcdn.net', 'skype.com',
'ucoz.ru', 'scribd.com', 'google.com.vn', 'soundcloud.com',
'google.com.co', 'google.gr', 'google.be', 'free.fr', 'download.com',
'pengyou.com', 'rediff.com', 'people.com.cn', 'optmd.com', 'naver.com',
'leboncoin.fr', 'w3schools.com', 'sweetim.com', 'xunlei.com', 'mgid.com',
'domaintools.com', 'nbcnews.com', 'archive.org', 'rapidshare.com',
'profitclicking.com', 'funmoods.com', 'it168.com', 'adultfriendfinder.com',
'files.wordpress.com', 'youjizz.com', 'isohunt.com', 'amazon.cn',
'flipkart.com', 'yesky.com', 'wsj.com', 'yelp.com', 'blogspot.com.es',
'uploaded.net', '58.com', 'google.com.ua', 'hostgator.com', '5000pk.com',
'taringa.net', 'google.at', 'google.com.tw', 'iqiyi.com', '4399.com',
'google.se', 'filestube.com', 'soku.com', 'samsung.com', 'orange.fr',
'nfl.com', 'indeed.com', 'google.ro', 'web.de', 'wp.pl', 'rutracker.org',
'dianxin.cn', 'tagged.com', 'bet365.com', 'libero.it', 'china.com',
'ilivid.com', 'yieldmanager.com', 'rambler.ru', 'cam4.com',
'tripadvisor.com', 'ups.com', 'telegraph.co.uk', 'kaixin001.com', 'hp.com',
'google.com.ph', 'gmx.net', '2345.com', 'aliexpress.com', 'kakaku.com',
'php.net', 'hudong.com', 'hatena.ne.jp', 'xing.com', 'tlbb8.com',
'github.com', 'reuters.com', 'wordreference.com', 'imageshack.us',
'paipai.com', 'csdn.net', 'thefreedictionary.com', 'ikea.com',
'google.com.pe', 'pandora.com', 'ameba.jp', 'tlbb2.com', 'putlocker.com',
'google.ch', 'hardsextube.com', 'google.com.ng', 'mashable.com',
'target.com', 'yourlust.com', 'google.com.sg', 'narod.ru', 'pof.com',
'rapidgator.net', 'forbes.com', 'google.cl', 'clickbank.com', 'hulu.com',
'weebly.com', 'etao.com', 'blogspot.co.uk', 'ero-advertising.com',
'mercadolivre.com.br', 'media.tumblr.com', 'washingtonpost.com',
'groupon.com', 'amazon.fr', 'ku6.com', 'soufun.com', 'in.com',
'hurriyet.com.tr', 'att.com', 'constantcontact.com', 'terra.com.br',
'youdao.com', 'shutterstock.com', 'ebay.it', 'movie2k.to',
'businessinsider.com', '360tl.com', 'usps.com', 'digitalpoint.com',
'9gag.com', 'dell.com', 't-online.de', 'huanqiu.com', 'popads.net',
'tlbbsifu.com', 'kaskus.co.id', 'bestbuy.com', 'ebay.com.au', 'goal.com',
'blogspot.de', 'linkbucks.com', 'nih.gov', 'milliyet.com.tr', 'kooora.com',
'bitauto.com', 'joomla.org', 'pchome.net', 'marca.com', 'typepad.com',
'xe.com', 'xcar.com.cn', 'extratorrent.com', 'battle.net',
'autohome.com.cn', 'drtuber.com', 'americanexpress.com', 'siteadvisor.com',
'mlb.com', 'seomoz.org', 'ebay.in', 'seznam.cz', 'mixi.jp', 'google.pt',
'gazeta.pl', 'dangdang.com', 'uimserv.net', 'iminent.com', 'elpais.com',
'blogspot.jp', 'twoo.com', 'gutefrage.net', 'ganji.com', 'match.com',
'mailchimp.com', 'bluehost.com', 'zimbio.com', 'agoda.com',
'pcauto.com.cn', 'aili.com', 'cj.com', 'java.com', 'ebay.fr',
'peyvandha.ir', 'zanox.com', 'infusionsoft.com', 'angege.com',
'google.co.hu', 'fedex.com', '4dsply.com', 'ig.com.br', 'nifty.com',
'detik.com', 'drudgereport.com', 'mycalendarbook.com', 'techcrunch.com',
'informer.com', 'gsmarena.com', 'google.cz', 'engadget.com', 'elmundo.es',
'speedtest.net', 'leo.org', 'webs.com', 'istockphoto.com',
'freelancer.com', 'vancl.com', 'google.dk', 'verizonwireless.com',
'pch.com', 'cntv.cn', 'ask.fm', 'akamaihd.net', 'turbobit.net', '2ch.net',
'seesaa.net', 'ezinearticles.com', 'chip.de', '51job.com', 'vnexpress.net',
'y8.com', 'usatoday.com', 'w3.org', 'goodreads.com', 'lemonde.fr',
'bannersbroker.com', 'naver.jp', 'letitbit.net', 'adserverplus.com',
'hdfcbank.com', 'yandex.ua', 'over-blog.com', 'livedoor.biz',
'alimama.com', 'google.ae', 'ign.com', 'dmm.co.jp', 'surveymonkey.com',
'homeway.com.cn', 'aizhan.com', 'wix.com', 'sergey-mavrodi.com',
'hubpages.com', '1channel.ch', 'mpnrs.com', 'ndtv.com', 'naukri.com',
'beeg.com', 'google.no', 'meetup.com', 'google.dz', 'kuxun.cn',
'jimdo.com', 'xgo.com.cn', 'adnxs.com', 'google.ie', 'abcnews.go.com',
'abril.com.br', 'histats.com', 'varzesh3.com', 'imesh.com',
'capitalone.com', 'fotolia.com', 'jobrapido.com', 'adultadworld.com',
'empowernetwork.com', 'daum.net', 'avito.ru', 'repubblica.it', '126.com',
'bloomberg.com', 'bitly.com', 'ning.com', 'viadeo.com', 'newegg.com',
'tjosurveys.com', 'wikihow.com', 'commentcamarche.net', 'google.co.il',
'irctc.co.in', 'cbssports.com', 'dianping.com', 'gmw.cn', 'maktoob.com',
'tinyurl.com', 'buzzfeed.com', 'google.fi', 'sape.ru', 'myfreecams.com',
'twitpic.com', 'rr.com', 'lefigaro.fr', 'google.co.kr', 'webmd.com',
'monster.com', 'kijiji.ca', 'zillow.com', 'mop.com', '10086.cn',
'multiply.com', 'expedia.com', 'bravotube.net', 'wretch.cc',
'largeporntube.com', 'mynet.com', 'clixsense.com', 'lzjl.com',
'livescore.com', 'ovh.net', 'icicibank.com', 'drupal.org', 'rbc.ru',
'outlook.com', 'stackexchange.com', 'mihanblog.com', '123rf.com',
'blackhatworld.com', 'latimes.com', 'softpedia.com', 'bleacherreport.com',
'microsoftonline.com', 'xda-developers.com', 'delicious.com', 'tmz.com',
'ya.ru', 'odesk.com', '39.net', 'nikkei.com', 'admin5.com',
'allrecipes.com', 'swagbucks.com', 'webmoney.ru', 'oracle.com',
'gotomeeting.com', 'livestrong.com', 'spankwire.com', 'tradedoubler.com',
'enet.com.cn', 'retailmenot.com', 'sahibinden.com', 'chinanews.com',
'ibm.com', 'nuvid.com', 'zing.vn', '1uuc.com', 'homedepot.com', '51.com',
'51.la', 'linkwithin.com', 'realclearpolitics.com', 'jiayuan.com',
'searchqu.com', 'mobile.de', 'sakura.ne.jp', 'backpage.com',
'so-net.ne.jp', 'itau.com.br', 'blogspot.gr', 'pcgames.com.cn',
'virgilio.it', 'taleo.net', 'news.com.au', 'mercadolibre.com.ar',
'folha.uol.com.br', 'yomiuri.co.jp', 'twimg.com', 'sj-tl.com', 'olx.in',
'website-unavailable.com', 'biglobe.ne.jp', 'discreethearts.com',
'macys.com', 'doorblog.jp', 'alphaporno.com', 'pornhublive.com',
'impress.co.jp', 'duowan.com', 'kankan.com', 'jqw.com', 'xyxy.net',
'dh818.com', 'altervista.org', 'lenta.ru', 'mapquest.com',
'zippyshare.com', 'issuu.com', 'exoclick.com', 'adscale.de', 'jquery.com',
'china.com.cn', 'youm7.com', 'keezmovies.com', 'nokia.com', 'habrahabr.ru',
'immobilienscout24.de', 'redbullstratos.com', 'persianblog.ir',
'corriere.it', 'hi5.com', 'accuweather.com', 'codecanyon.net', 'digg.com',
'google.sk', 'quikr.com', 'gc.ca', 'mercadolibre.com.mx', 'google.co.ma',
'oneindia.in', 'tabnak.ir', 'gap.com', 'getresponse.com', 'adsupply.com',
'suning.com', 'porn.com', 'thesun.co.uk', 'qunar.com', 'pclady.com.cn',
'pixnet.net', '189.cn', 'quora.com', 'tabelog.com', 'icbc.com.cn',
'heise.de', 'xtube.com', 'zhaopin.com', 'zynga.com', 'force.com',
'tribalfusion.com', 'elance.com', 'verizon.com', '7k7k.com', 'blogimg.jp',
'timeanddate.com', 'feedburner.com', 'alnaddy.com', 'careerbuilder.com',
'yellowpages.com', 'people.com', 'ccb.com', 'warriorplus.com',
'ancestry.com', 'cbsnews.com', '968tl.com', 'wiktionary.org',
'foxsports.com', 'bitshare.com', 'qidian.com', 'haberturk.com',
'livingsocial.com', 'pogo.com', 'sapo.pt', 'mp3skull.com',
'templatemonster.com', 'examiner.com', '52tlbb.com', 'cnblogs.com',
'list-manage.com', 'hidemyass.com', 'moneycontrol.com', 'watchseries.eu',
'exblog.jp', '118114.cn', 'eastmoney.com', 'torrentz.in', 'v9.com',
'21cn.com', 'kinopoisk.ru', 'hotfile.com', 'custhelp.com',
'cheezburger.com', 'justdial.com', 'okcupid.com', 'kohls.com',
'porntube.com', 'wunderground.com', 'interia.pl', 'filehippo.com',
'114so.cn', 'citibank.com', 'nikkeibp.co.jp', 'cnbc.com',
'autosottocosto.com', 'time.com', 'grindtv.com', 'sexitnow.com',
'miniclip.com', 'excite.co.jp', '4tube.com', 'tom.com', 'lequipe.fr',
'netlog.com', 'xhamstercams.com', 'lifehacker.com', 'sears.com',
'gawker.com', 'inbox.com', 'pixiv.net', 'searchengines.ru',
'shopathome.com', 'bodybuilding.com', 'tutsplus.com', 'nhk.or.jp',
'sulekha.com', 'intuit.com', 'msn.com.cn', 'ultimatepowerprofits.com',
'blog.163.com', '12306.cn', 'welt.de', 'imagevenue.com', 'google.az',
'acesse.com', 'chinabyte.com', 'userapi.com', 'twcczhu.com',
'politico.com', 'who.is', 'yoka.com', 'orkut.com', 'kickstarter.com',
'classmates.com', 'trulia.com', 'disney.go.com', 'zwaar.net',
'gizmodo.com', 'amung.us', 'blog.com', 'babycenter.com', 'linksynergy.com',
'indianrail.gov.in', 'nu.nl', 'google.co.nz', 'slickdeals.net',
'imagebam.com', 'hupu.com', 'pornerbros.com', '888.com', 'lenovo.com',
'tinypic.com', 'cbslocal.com', 'anonym.to', 'coupons.com', '1und1.de',
'6.cn', 'cocolog-nifty.com', 'yxlady.com', 'marketwatch.com',
'sitesell.com', 'as.com', 'manta.com', 'adfoc.us', 'kompas.com',
'google.lk', 'ggmm777.com', 'blekko.com', 'mybrowserbar.com', 'ca.gov',
'farsnews.com', 'zendesk.com', 'hotels.com', 'itmedia.co.jp',
'hubspot.com', 'fatakat.com', 'howstuffworks.com', 'zappos.com',
'video-one.com', 'lady8844.com', 'myegy.com', 'dict.cc', 'onlylady.com',
'businessweek.com', '52pk.net', 'wired.com', 'crsky.com', 'shareasale.com',
'barnesandnoble.com', 'pagesjaunes.fr', 'namecheap.com', 'metacafe.com',
'cmbchina.com', 'nba.com', 'makeuseof.com', 'ocn.ne.jp', 'infolinks.com',
'jabong.com', 'thedailybeast.com', 'td.com', 'whitepages.com', 'nasa.gov',
'tnaflix.com', 'urbandictionary.com', 'klikbca.com', 'sfr.fr',
'statscrop.com', 'free-tv-video-online.me', 'aftonbladet.se',
'nikkansports.com', 'vente-privee.com', 'woot.com', 'orf.at',
'nudevista.com', 'allocine.fr', 'klicktrek.com', 'tenpay.com',
'freakshare.com', 'ustream.tv', 'okwave.jp', 'europa.eu', 'macrumors.com',
'patch.com', 'subito.it', 'overstock.com', 'google.bg', 'asahi.com',
'alarabiya.net', 'magentocommerce.com', 'idnes.cz', 'focus.de',
'earthlink.net', 'masrawy.com', 'wcarev.com', 'rottentomatoes.com',
'eventbrite.com', 'snapdeal.com', 'ucoz.com', 'mangareader.net',
'nydailynews.com', 'smashingmagazine.com', 'way2sms.com', 'eztv.it',
'state.gov', 'verycd.com', '24h.com.vn', 'geocities.jp', 'admagnet.net',
'hypergames.net', 'smh.com.au', 'dpreview.com', 'novinky.cz',
'subscene.com', 'ppstream.com', 'jrj.com.cn', 'shaadi.com', 'gumtree.com',
'priceline.com', 'baixing.com', 'southwest.com', 'roulettebotplus.com',
'dantri.com.vn', 'rakuten.ne.jp', 'disqus.com', 'ebay.ca', 'hsbc.co.uk',
'softlayer.com', 'scoop.it', 'rightmove.co.uk', 'mercadolibre.com.ve',
'japanpost.jp', 'gi-akademie.com', 'bankmellat.ir', 'citrixonline.com',
'yandex.kz', 'blackberry.com', 'theblaze.com', 'dmoz.org', 'bartarinha.ir',
'h2porn.com', 'quickmeme.com', 'google.com.ec', 'twitch.tv', 'cloob.com',
'xbox.com', '55bbs.com', 'slutload.com', 'gamespot.com', 'usbank.com',
'alot.com', 'forgeofempires.com', 'rednet.cn', 'google.com.kw',
'orkut.com.br', 'skyrock.com', 'ctrip.com', 'bahn.de', 'npr.org',
'sky.com', 'logmein.com', 'ce.cn', 'sootoo.com', 'marktplaats.nl',
'partypoker.com', 'idealo.de', 'linternaute.com', 'skycn.com',
'wowhead.com', 'lowes.com', 'last.fm', 'motherless.com', 'toysrus.com',
'mediaset.it', 'dreamstime.com', 'asos.com', 'eastday.com', 'slate.com',
'foursquare.com', 'adult-empire.com', 'zoho.com', 'bhaskar.com', 'sbrf.ru',
'perfectgirls.net', 'logsoku.com', 'mysql.com', 'steampowered.com',
'cloudfront.net', 'google.com.do', 'extabit.com', 'fotostrana.ru',
'easyhits4u.com', 'foodnetwork.com', 'google.com.qa', 'filecrop.com',
'51buy.com', 'cracked.com', 'ixxx.com', 'akhbarak.net', 'imgchili.com',
'atwiki.jp', 'sockshare.com', 'onlinesbi.com', 'opensiteexplorer.org',
'babytree.com', 'sueddeutsche.de', 'yihaodian.com', 'nordstrom.com',
'meilishuo.com', 'jeuxvideo.com', 'udn.com', 'telegraaf.nl', 'goo.gl',
'directadvert.ru', 'dx.com', 'hm.com', 'friv.com', 'streamate.com',
'18andabused.com', 'piriform.com', 'r7.com', 'pptv.com', 'onlinedown.net',
'posterous.com', 'tala.ir', 'flashx.tv', 'ci123.com', '115.com',
'kayak.com', 'lolmake.com', 'makemytrip.com', 'pcmag.com', 'mail.com',
'tubegalore.com', 'dhl.de', 'homeshop18.com', 'beemp3.com', 'nyaa.eu',
'cnr.cn', 'sanjesh.org', 'zoosk.com', 'gi-backoffice.com', 'legacy.com',
'leagueoflegends.com', 'baomihua.com', 'm-w.com', 'semrush.com',
'chuangelm.com', 'realtor.com', 'sberbank.ru', 'clarin.com', 'reverso.net',
'19lou.com', 'betfair.com', 'esporte.uol.com.br', 'bbc.com',
'ahram.org.eg', 'worldstarhiphop.com', 'searchengineland.com',
'icloud.com', 'biblegateway.com', 'grooveshark.com', 'cy-pr.com',
'nextag.com', 'discuz.net', 'docstoc.com', 'uwavou.com', 'blogspot.kr',
'liveleak.com', 'pornoxo.com', 'prestashop.com', 'kdnet.net', 'weblio.jp',
'ea.com', 'jcpenney.com'];


var themes = [
  {
    id: 'unsafe',
    name: 'Unsafe Site',
    headerURL: 'https://people.mozilla.com/~bwinton/shadysite/unsafe_header.png',
    footerURL: 'https://people.mozilla.com/~bwinton/shadysite/unsafe_footer.png',
    textcolor: '#000',
    accentcolor: '#eee'
  },
  {
    id: 'safe',
    name: 'Safe Site',
    headerURL: 'https://people.mozilla.com/~bwinton/shadysite/safe_header.png',
    footerURL: 'https://people.mozilla.com/~bwinton/shadysite/safe_footer.png',
    textcolor: '#000',
    accentcolor: '#eee'
  }
];
 
const INSTALL = 'InstallBrowserTheme';
const PREVIEW = 'PreviewBrowserTheme';
const RESET_PREVIEW = 'ResetBrowserThemePreview';

function log(message) {
  self.port.emit("message", message);
}

function getBaseDomain(domain) {
  self.port.emit("basedomain", domain);
}

function addPerm(domain) {
  self.port.emit("addPerm", domain);  
}

function delPerm(domain) {
  self.port.emit("delPerm", domain);  
}

function setTheme(node, theme, action) {
  node.setAttribute('data-browsertheme', JSON.stringify(themes[theme]));
  var event = document.createEvent('Events');
  event.initEvent(action, true, false);
  node.dispatchEvent(event);
}

var basedomain = document.documentURI;

var themeElem = document.getElementById('themeElem');
if (themeElem === null) {
  themeElem = document.createElement('div');
  themeElem.id = 'themeElem';
  document.body.appendChild(themeElem);
}

self.port.on("basedomain", function(aBasedomain) {
  log("basedomain = " + aBasedomain);
  basedomain = aBasedomain;
  addPerm(document.documentURI);
});

self.port.on("addPerm", function() {
  log("basedomain = " + basedomain);
  setTheme(document.body, (top1000.indexOf(basedomain) == -1) ? 0 : 1, INSTALL);
  setTimeout(function() {
    delPerm(basedomain);
  }, 1000);
});

// Kick it all off…
getBaseDomain(document.domain);